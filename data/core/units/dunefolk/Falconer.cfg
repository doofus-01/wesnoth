#textdomain wesnoth-units

#define PATH_TEMP
units/dunefolk/skirmisher/#enddef

# this does not work, at least the nested [filter] doesn't
#define DISTRACTION_FILTER
        [filter_adjacent]
#            adjacent=n,s
            is_enemy=yes
#            [filter]
#                [filter_adjacent]
#                    is_enemy=yes
#                    count=2-6
#                    adjacent=n,s
#                [/filter_adjacent]
#            [/filter]
        [/filter_adjacent]
#enddef

[unit_type]
    id=Dune Falconer
    name= _ "female^Dune Falconer"
    race=dunefolk
    gender=female
    image="{PATH_TEMP}falconer.png"
    hitpoints=36
    movement_type=duneelusivefoot
    movement=6
    vision=8
    experience=78
    level=2
    alignment=lawful
    advances_to=Dune Sky Hunter
    cost=23
    usage=mixed fighter
    description= _ "The power of any Dunefolk assault is inhibited by one major drawback: organized Dunefolk forces tend to be rather slow. Because of this, enemy forces often have the ability to regroup and call upon reinforcements, in which case a second assault becomes much more difficult.  Dune Falconers, an advanced corps pulled the skirmisher auxiliaries, have trained young falcons to fly directly back to them if the bird sees any humanoid or larger creature.  From the direction and flight time, the Falconer can estimate the direction and distance of any remote presence.  While this intelligence has limitations, it can be quite valuable in many contexts.  

The falcon also plays a role in combat, as the falconer can either direct it directly at a foe, or it can be sent higher into the air, to circle overhead and strike when the foe has shifted attention.  Needless to say, this can be very distracting to any opponent."
    {NOTE_SKIRMISHER}
#    {NOTE_} # for distract or whatever
    die_sound={SOUND_LIST:HUMAN_FEMALE_DIE}
# some day we can need this    {DEFENSE_ANIM "{PATH_TEMP}falconer-falcon-defend2.png" "{PATH_TEMP}falconer-falcon-defend1.png" {SOUND_LIST:HUMAN_FEMALE_HIT} }
    [defend]
        start_time=-126
        falcon_start_time=-126
        [frame]
            image="{PATH_TEMP}falconer-alone-defend1.png:1,{PATH_TEMP}falconer-alone-defend2.png:250,{PATH_TEMP}falconer-alone-defend1.png:1"
        [/frame]
        [falcon_frame]
            image="{PATH_TEMP}falcon-hover.png:252"
            y=-40
            auto_vflip=no
        [/falcon_frame]
        [if]
            hit_sound_start_time=-25
            hits=hit
            [hit_sound_frame]
                sound={SOUND_LIST:HUMAN_FEMALE_HIT} 
            [/hit_sound_frame]
        [/if]
    [/defend]

    [abilities]
        {ABILITY_SKIRMISHER}
        {ABILITY_DISTRACTION}
    [/abilities]
    [post_movement_anim]
        start_time=0
        falcon_start_time=0
        [filter]
            {DISTRACTION_FILTER}
        [/filter]
        [frame]
            image="{PATH_TEMP}falconer-launch[1~5].png:[250,200,150,100,100]"
        [/frame]
        [falcon_frame]
            image="misc/blank-hex.png:600,{PATH_TEMP}falcon-rise.png:200"
            auto_vflip=no
            y=-45:600,-45~-40:200
        [/falcon_frame]
    [/post_movement_anim]
    [standing_anim]
        start_time=0
        falcon_start_time=0
        [if]
        [filter]
            {DISTRACTION_FILTER}
        [/filter]
        [frame]
            image="{PATH_TEMP}falconer-alone.png:800"
        [/frame]
        [falcon_frame]
            image="{PATH_TEMP}falcon-hover.png:800"
            x=-0~5:200,5~-5:400,-5~0:200
            y=-40~-45:400,-45~-40:400
            auto_vflip=no
        [/falcon_frame]
        [/if]
        [else]
        [frame]
            image="{PATH_TEMP}falconer.png:200"
        [/frame]
        [/else]
    [/standing_anim]

    [attack]
        name=sword
        description= _ "short sword"
        type=blade
        range=melee
        damage=5
        number=4
        icon=attacks/sword-human-short.png
    [/attack]
    # Maybe the bird should have some "marksman" ability, since it actively corrects its flight.
    # But we also have to account for the defender not being able to hurt the bird.
    # So, we can say that the bird only strikes if it is safe, and a defender on favorable terrain can scare the bird off more often
    [attack]
        name=falcon
        description= _ "falcon"
        type=blade
        range=ranged
        damage=10
        number=2
        icon=attacks/claws.png
    [/attack]

    [attack_anim]
        [filter_attack]
            name=sword
        [/filter_attack]
        start_time=-250
        falcon_start_time=-250
        [frame]
            image="{PATH_TEMP}falconer-alone.png:300"
        [/frame]
        [falcon_frame]
            image="{PATH_TEMP}falcon-hover.png:300"
            auto_vflip=no
            y=-45~-40:300
        [/falcon_frame]
        {SOUND:HIT_AND_MISS {SOUND_LIST:SWORD_SWISH} {SOUND_LIST:MISS} -100}
    [/attack_anim]
    [attack_anim]
        [filter_attack]
            name=falcon
        [/filter_attack]
        start_time=-150
        missile_start_time=-150
        [if]
            hits=yes
            [missile_frame]
                image="{PATH_TEMP}falcon-n.png:300,{PATH_TEMP}falcon-n.png~FL(vert):400"
                image_diagonal="{PATH_TEMP}falcon-e.png:300,{PATH_TEMP}falcon-e.png~FL(horiz):400"
                y=-43~0:150,0~-43:150,-43:400
                offset=0~0.8:150,0.8~1.6:150,1.6~0:400
            [/missile_frame]
            [frame]
                image="{PATH_TEMP}falconer-alone.png:700"
                sound=gryphon-shriek-1.ogg
            [/frame]
        [/if]
        [else]
            hits=no
            [missile_frame]
                image="{PATH_TEMP}falcon-n.png:300,{PATH_TEMP}falcon-n.png~FL(vert):400"
                image_diagonal="{PATH_TEMP}falcon-e.png:300,{PATH_TEMP}falcon-e.png~FL(horiz):400"
                y=-43~-56:150,-56:150,-56~-43:400
                offset=0~0.8:150,0.8~1.6:150,1.6~0:400
            [/missile_frame]
            [frame]
                image="{PATH_TEMP}falconer-alone.png:700"
                sound=bat-flapping.wav
            [/frame]
        [/else]
    [/attack_anim]
[/unit_type]

#undef PATH_TEMP
#undef DISTRACTION_FILTER
